define("app/task/script",[],function(){function e(e){return e&&(t=e),t}var t={};return e}),define("app/task/settings",["./script"],function(e){function t(t){var r=e().settings||{};return t?r[t]:r}return t}),define("app/trial/current_trial",[],function(){var e;return function(t){return t&&(e=t),e}}),define("app/task/adjust_canvas",["jquery","app/task/settings","app/trial/current_trial"],function(e,t,r){function n(n){function i(){var t,i;if(s.width){if(!n)return!0;i=s.width,t=i*a}else{var u={width:e(window).innerWidth(),height:e(window).innerHeight()},c=u.height,l=Math.min(s.maxWidth,u.width);c>a*l?(t=l*a,i=l):(t=c,i=c/a)}t-=parseInt(o.$el.css("border-top-width"),10)+parseInt(o.$el.css("border-bottom-width"),10)+parseInt(o.$el.css("margin-top"),10),i-=parseInt(o.$el.css("border-left-width"),10)+parseInt(o.$el.css("border-right-width"),10),o.$el.width(i),o.$el.height(t),o.$el.css("font-size",t*(s.textSize||3)/100),r()&&(r()._layout_collection.refresh(),r()._stimulus_collection.refresh()),window.scrollTo(0,1)}var a,o=this,s=t("canvas")||{};if(s.proportions)if(e.isPlainObject(s.proportions)){if("number"!=typeof s.proportions.height||"number"!=typeof s.proportions.width)throw new Error("The canvas proportions object`s height and a width properties must be numeric");a=s.proportions.height/s.proportions.width}else a=s.proportions||.8;setTimeout(i,n?0:500)}return n}),define("text",["module"],function(e){var t,r,n,i,a,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,l=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,p=c&&(location.port||void 0),f={},h=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(u);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){r=o[t];try{e=new ActiveXObject(r)}catch(n){}if(e){o=[r];break}}return e},parseName:function(e){var t,r,n,i=!1,a=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==a&&(!o||a>1)?(t=e.substring(0,a),r=e.substring(a+1,e.length)):t=e,n=r||t,a=n.indexOf("!"),-1!==a&&(i="strip"===n.substring(a+1),n=n.substring(0,a),r?r=n:t=n),{moduleName:t,ext:r,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,r,n,i){var a,o,s,u=t.xdRegExp.exec(e);return u?(a=u[2],o=u[3],o=o.split(":"),s=o[1],o=o[0],!(a&&a!==r||o&&o.toLowerCase()!==n.toLowerCase()||(s||o)&&s!==i)):!0},finishLoad:function(e,r,n,i){n=r?t.strip(n):n,h.isBuild&&(f[e]=n),i(n)},load:function(e,r,n,i){if(i&&i.isBuild&&!i.inlineText)return void n();h.isBuild=i&&i.isBuild;var a=t.parseName(e),o=a.moduleName+(a.ext?"."+a.ext:""),s=r.toUrl(o),u=h.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void n():void(!c||u(s,l,d,p)?t.get(s,function(r){t.finishLoad(e,a.strip,r,n)},function(e){n.error&&n.error(e)}):r([o],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,n)}))},write:function(e,r,n){if(f.hasOwnProperty(r)){var i=t.jsEscape(f[r]);n.asModule(e+"!"+r,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,r,n,i,a){var o=t.parseName(r),s=o.ext?"."+o.ext:"",u=o.moduleName+s,c=n.toUrl(o.moduleName+s)+".js";t.load(u,n,function(){var r=function(e){return i(c,e)};r.asModule=function(e,t){return i.asModule(e,c,t)},t.write(e,u,r,a)},a)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(r=require.nodeRequire("fs"),t.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");0===i.indexOf("ï»¿")&&(i=i.substring(1)),t(i)}catch(a){n&&n(a)}}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,r,n,i){var a,o=t.createXhr();if(o.open("GET",e,!0),i)for(a in i)i.hasOwnProperty(a)&&o.setRequestHeader(a.toLowerCase(),i[a]);h.onXhr&&h.onXhr(o,e),o.onreadystatechange=function(){var t,i;4===o.readyState&&(t=o.status||0,t>399&&600>t?(i=new Error(e+" HTTP status: "+t),i.xhr=o,n&&n(i)):r(o.responseText),h.onXhrComplete&&h.onXhrComplete(o,e))},o.send(null)}:"rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var r,n,i="utf-8",a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),i)),u="";try{for(r=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&r.append(n);null!==(n=s.readLine());)r.append(o),r.append(n);u=String(r.toString())}finally{s.close()}t(u)}:("xpconnect"===h.env||!h.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var r,o,s,u={};a&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{r=n["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),r.init(s,1,0,!1),o=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(r,"utf-8",r.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(r.available(),u),o.close(),r.close(),t(u.value)}catch(c){throw new Error((s&&s.path||"")+": "+c)}}),t}),define("text!templates/loading.html",[],function(){return'<style>\r\n/**\r\n * Loading page progress bars\r\n * http://css-tricks.com/css3-progress-bars/\r\n */\r\n 	.meter-wrapper{\r\n 		position: relative;\r\n		top:50%;\r\n 	}\r\n\r\n	.meter {\r\n		height: 30px;  /* Can be anything */\r\n		position: relative;\r\n		margin-left: auto; margin-right: auto;\r\n		margin-top:-15px;\r\n		width:82%;\r\n		background: #555;\r\n		-moz-border-radius: 25px;\r\n		-webkit-border-radius: 25px;\r\n		border-radius: 25px;\r\n		padding: 10px;\r\n		-webkit-box-shadow: inset 0 -1px 1px rgba(255,255,255,0.3);\r\n		-moz-box-shadow   : inset 0 -1px 1px rgba(255,255,255,0.3);\r\n		box-shadow        : inset 0 -1px 1px rgba(255,255,255,0.3);\r\n	}\r\n	.meter > span {\r\n		display: block;\r\n		height: 100%;\r\n		   -webkit-border-top-right-radius: 8px;\r\n		-webkit-border-bottom-right-radius: 8px;\r\n			   -moz-border-radius-topright: 8px;\r\n			-moz-border-radius-bottomright: 8px;\r\n				   border-top-right-radius: 8px;\r\n				border-bottom-right-radius: 8px;\r\n			-webkit-border-top-left-radius: 20px;\r\n		 -webkit-border-bottom-left-radius: 20px;\r\n				-moz-border-radius-topleft: 20px;\r\n			 -moz-border-radius-bottomleft: 20px;\r\n					border-top-left-radius: 20px;\r\n				 border-bottom-left-radius: 20px;\r\n		background-color: rgb(43,194,83);\r\n		background-image: -webkit-gradient(\r\n		  linear,\r\n		  left bottom,\r\n		  left top,\r\n		  color-stop(0, rgb(43,194,83)),\r\n		  color-stop(1, rgb(84,240,84))\r\n		 );\r\n		background-image: -moz-linear-gradient(\r\n		  center bottom,\r\n		  rgb(43,194,83) 37%,\r\n		  rgb(84,240,84) 69%\r\n		 );\r\n		-webkit-box-shadow:\r\n		  inset 0 2px 9px  rgba(255,255,255,0.3),\r\n		  inset 0 -2px 6px rgba(0,0,0,0.4);\r\n		-moz-box-shadow:\r\n		  inset 0 2px 9px  rgba(255,255,255,0.3),\r\n		  inset 0 -2px 6px rgba(0,0,0,0.4);\r\n		box-shadow:\r\n		  inset 0 2px 9px  rgba(255,255,255,0.3),\r\n		  inset 0 -2px 6px rgba(0,0,0,0.4);\r\n		position: relative;\r\n		overflow: hidden;\r\n	}\r\n	.meter > span:after, .animate > span > span {\r\n		content: "";\r\n		position: absolute;\r\n		top: 0; left: 0; bottom: 0; right: 0;\r\n		background-image:\r\n		   -webkit-gradient(linear, 0 0, 100% 100%,\r\n			  color-stop(.25, rgba(255, 255, 255, .2)),\r\n			  color-stop(.25, transparent), color-stop(.5, transparent),\r\n			  color-stop(.5, rgba(255, 255, 255, .2)),\r\n			  color-stop(.75, rgba(255, 255, 255, .2)),\r\n			  color-stop(.75, transparent), to(transparent)\r\n		   );\r\n		background-image:\r\n			-moz-linear-gradient(\r\n			  -45deg,\r\n			  rgba(255, 255, 255, .2) 25%,\r\n			  transparent 25%,\r\n			  transparent 50%,\r\n			  rgba(255, 255, 255, .2) 50%,\r\n			  rgba(255, 255, 255, .2) 75%,\r\n			  transparent 75%,\r\n			  transparent\r\n		   );\r\n		z-index: 1;\r\n		-webkit-background-size: 50px 50px;\r\n		-moz-background-size: 50px 50px;\r\n		-webkit-animation: move 2s linear infinite;\r\n		   -webkit-border-top-right-radius: 8px;\r\n		-webkit-border-bottom-right-radius: 8px;\r\n			   -moz-border-radius-topright: 8px;\r\n			-moz-border-radius-bottomright: 8px;\r\n				   border-top-right-radius: 8px;\r\n				border-bottom-right-radius: 8px;\r\n			-webkit-border-top-left-radius: 20px;\r\n		 -webkit-border-bottom-left-radius: 20px;\r\n				-moz-border-radius-topleft: 20px;\r\n			 -moz-border-radius-bottomleft: 20px;\r\n					border-top-left-radius: 20px;\r\n				 border-bottom-left-radius: 20px;\r\n		overflow: hidden;\r\n	}\r\n\r\n	.animate > span:after {\r\n		display: none;\r\n	}\r\n\r\n	@-webkit-keyframes move {\r\n		0% {\r\n		   background-position: 0 0;\r\n		}\r\n		100% {\r\n		   background-position: 50px 50px;\r\n		}\r\n	}\r\n\r\n	.orange > span {\r\n		background-color: #f1a165;\r\n		background-image: -moz-linear-gradient(top, #f1a165, #f36d0a);\r\n		background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f1a165),color-stop(1, #f36d0a));\r\n		background-image: -webkit-linear-gradient(#f1a165, #f36d0a);\r\n	}\r\n\r\n	.red > span {\r\n		background-color: #f0a3a3;\r\n		background-image: -moz-linear-gradient(top, #f0a3a3, #f42323);\r\n		background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f0a3a3),color-stop(1, #f42323));\r\n		background-image: -webkit-linear-gradient(#f0a3a3, #f42323);\r\n	}\r\n\r\n	.nostripes > span > span, .nostripes > span:after {\r\n		-webkit-animation: none;\r\n		background-image: none;\r\n	}\r\n</style>\r\n\r\n<div class="meter-wrapper">\r\n	<div class="meter">\r\n		<span style="width: 0%"></span>\r\n	</div>\r\n</div>'}),define("app/task/main_view",["backbone","jquery","./adjust_canvas","app/task/script","text!templates/loading.html"],function(e,t,r,n,i){var a=t.Deferred(),o=e.View.extend({id:"canvas",initialize:function(){this.activate=t.proxy(this.activate,this),this.render=t.proxy(this.render,this),t(window).on("orientationchange resize",t.proxy(this.adjustCanvas,this))},render:function(){return this.adjustCanvas(!0),this},activate:function(){var e=this,r=n().settings.canvas||{};return t(document).ready(function(){r.background&&t("body").css("background-color",r.background),r.canvasBackground&&e.$el.css("background-color",r.canvasBackground),r.borderColor&&e.$el.css("border-color",r.borderColor),r.borderWidth&&e.$el.css("border-width",r.borderWidth),r.css&&e.$el.css(r.css),t("[pi-player]").length?t("[pi-player]").empty().append(e.$el):e.$el.appendTo("body"),e.render(),a.resolve()}),this},loading:function(e){if("pending"!=e.state())return e;this.$el.html(i);var t=this.$(".meter span");return e.progress(function(e,r){t.width((r?e/r*100:0)+"%")})},empty:function(){this.$el.empty()},docReady:function(){return a},adjustCanvas:r});return new o}),define("models/set",["backbone","underscore"],function(e,t){var r=e.Collection.extend({orderList:[],nextPick:0,whereData:function(e){return t.isEmpty(e)?[]:this.filter(function(t){var r=t.get("data")||{};for(var n in e)if(e[n]!==r[n])return!1;return!0})},random:function(){return this.at(Math.floor(Math.random()*this.length)).attributes},exRandom:function(){return this.orderList=this.orderList.length?this.orderList:t.shuffle(t.range(this.length)),this.at(this.orderList.pop()).attributes},bySequence:function(){return this.nextPick<this.length||(this.nextPick=0),this.at(this.nextPick++).attributes},byData:function(e){if(t.isUndefined(e.data))throw console.log(e),new Error("A data property must by defined for byData");var r=t.isString(e.data)?{handle:e.data}:e.data,n=this.whereData(r)[0];if(!n)throw new Error("Inherit by Data failed. Data not found: "+e.data);return n.attributes},getInherited:function(e){if(t.isFunction(e.type))return e.type.call(this,e);switch(e.type){case"bySequence":return this.bySequence();case"byData":return this.byData(e);case"exRandom":return this.exRandom();case"random":default:return this.random()}},inherit:function(e){if(!this.length)throw new Error("You attempted to inherit from an empty set ({"+this.name+"})");var t=this.getInherited(e);if(!t)throw new Error("You tried to inherit from {"+this.name+"} but an appropriate element was not found");return t}});return r}),define("app/sets_constructor",["underscore","models/set"],function(e,t){function r(){function r(r){return e.each(r,function(e,r){n[r]=new t(e),n[r].name=r}),n}var n={};return r}return r}),define("app/trial/trial_sets",["../sets_constructor"],function(e){return new e}),define("app/stimulus/stimulus_sets",["../sets_constructor"],function(e){return new e}),define("app/media/media_sets",["../sets_constructor"],function(e){return new e}),define("models/collection",["underscore"],function(e){var t=function(){this.collection=[],this.pointer=-1};return e.extend(t.prototype,{first:function(){return this.pointer=0,this.collection[this.pointer]},last:function(){return this.pointer=this.collection.length-1,this.collection[this.pointer]},end:function(){return void(this.pointer=this.collection.length)},current:function(){return this.collection[this.pointer]},next:function(){return this.collection[++this.pointer]},previous:function(){return this.collection[--this.pointer]},add:function(t){return arguments.length?(t=e.isArray(t)?t:[t],this.collection=this.collection.concat(t),this):this},at:function(e){return this.collection[e]}}),t}),define("app/sequencer/sourceSequence",["models/collection","underscore"],function(e,t){var r=new e,n=function(e,t){for(var r in t)if(t[r]!==e[r])return!1;return!0};return t.extend(r,{nextWhere:function(e){for(;this.next()&&!n(this.current().data||{},e););return this.current()},lastWhere:function(e){for(;this.previous()&&!n(this.current().data||{},e););return this.current()}}),r}),define("utils/mixer",["underscore"],function(e){var t=function(r,n){var i=[];return e.each(r,function(r){var a,o,s,u=e.isObject(r)?r.mixer:void 0;switch(u){case"random":a=e.shuffle(t(r.data,!0)),o=n?a:t(a),i=i.concat(o);break;case"weightedRandom":var c=e.reduce(r.weights,function(e,t){return e+t}),l=Math.random()*c,d=0;for(s=0;s<r.data.length;s++)if(d+=r.weights[s],d=+d.toFixed(3),d>=l){a=[r.data[s]];break}o=n?a:t(a),i=i.concat(o);break;case"choose":a=e.chain(r.data).shuffle().first(r.n?r.n:1).value(),o=n?a:t(a),i=i.concat(o);break;case"repeat":for(a=t(r.data,!0),s=0;s<r.times;s++)o=n?a:t(a),i=i.concat(o);break;case"wrapper":n?i.push(r):i=i.concat(t(r.data));break;case void 0:i.push(r);break;default:throw new Error("Unknown wrapper "+u)}}),i};return t}),define("utils/preloader",["jquery"],function(e){var t=[],r=[],n=0,i=e.Deferred(),a=function(a,o){if(o=o||"image",-1==e.inArray(a,t)){var s=e.Deferred();switch(o){case"template":require(["text!"+a],function(){s.resolve()},function(){throw new Error("Template not found: "+a)});break;case"image":default:var u=new Image;e(u).on("load",function(){s.resolve()}),e(u).one("error",function(){u.src="",u.src=a,e(u).on("error",function(){throw new Error('Image not found: "'+a+'"')})}),u.src=a}return r.push(s),t.push(a),s.done(function(){n++,i.notify(n,r.length)}),s}return!1};return{add:a,activate:function(){return e.when.apply(e,r).done(function(){i.resolve()}).fail(function(){i.reject()}),i.promise()},reset:function(){t=[],r=[],n=0,i=this.state=e.Deferred()},state:i}}),define("app/task/build_url",["underscore","./settings"],function(e,t){return function(r,n){var i,a=t();return e.isString(a.base_url)?i=a.base_url:e.isObject(a.base_url)&&(i=a.base_url[n]),"image"==n&&/^data:image/.test(r)?r:(i?"/"!=i[i.length-1]&&(i+="/"):i="",i+r)}}),define("app/sequencer/sequencePreload",["underscore","utils/preloader","app/task/build_url"],function(e,t,r){var n=function(n){e.isUndefined(n.image)||t.add(r(n.image,"image"),"image"),e.isUndefined(n.template)||t.add(r(n.template,"template"),"template")},i=function(e){e.media&&n(e.media)},a=function(e){e.element&&n(e.element)},o=function(t){e.each(t.layout||[],i),e.each(t.stimuli||[],i),e.each(t.input||[],a)},s=function(t){e.each(t,function(t){e.isUndefined(t.mixer)?o(t):s(t.data)})},u=function(t){e.each(t.mediaSets||[],function(t){e.each(t,n)}),e.each(t.stimulusSets||[],function(t){e.each(t,i)}),e.each(t.trialSets||[],function(t){e.each(t,o)}),s(t.sequence)};return function(e,r,a){switch(a&&t.reset(),r){case"media":n(e);break;case"stimulus":i(e);break;case"trial":o(e);break;case"script":default:u(e)}return t.activate()}}),define("app/task/parser",["require","app/task/script","../trial/trial_sets","../stimulus/stimulus_sets","../media/media_sets","../sequencer/sourceSequence","utils/mixer","../sequencer/sequencePreload"],function(e){var t=e("app/task/script"),r=e("../trial/trial_sets"),n=e("../stimulus/stimulus_sets"),i=e("../media/media_sets"),a=e("../sequencer/sourceSequence"),o=e("utils/mixer"),s=e("../sequencer/sequencePreload");return function(){var e=t();return e.trialSets&&r(e.trialSets),e.stimulusSets&&n(e.stimulusSets),e.mediaSets&&i(e.mediaSets),a.add(o(e.sequence)),s(e)}}),define("app/sequencer/trialSequence",["models/collection"],function(e){return new e}),define("utils/pubsub",["underscore"],function(e){var t={},r={},n={};return t.publish=function(n,i){r[n]&&e.each(r[n],function(e){e.apply(t,i||[])})},t.subscribe=function(t,i){var a;return e.isFunction(i)?a=[]:(a=arguments[1],i=arguments[2]),r[t]||(r[t]={},n[t]=0),r[t][n[t]++]=i,a.push([t,i]),[t,i]},t.unsubscribe=function(t){var n=t[0];r[n]&&e.each(r[n],function(e,i){e==t[1]&&delete r[n][i]})},t}),define("utils/is_touch",[],function(){return"ontouchstart"in window?!0:!1}),define("utils/interface/bindings/click",["jquery","utils/is_touch"],function(e,t){return function(r,n){var i=t?"touchstart":"mousedown",a=n.element?!1:!0,o=e(n.element);r.on=function(t){var r=function(e){t(e,i)};a?e(document).on(i+".interface",'[data-handle="'+n.stimHandle+'"]',r):o.css(n.css||{}).appendTo("#canvas").on(i+".interface",r)},r.off=function(){a?e(document).off(i+".interface",'[data-handle="'+n.stimHandle+'"]'):o.remove()}}}),define("utils/interface/bindings/keypressed",["jquery"],function(e){var t=[];e(document).on("keyup.keypressed",function(e){t[e.which]=!1});var r=function(r){var n=e.isArray(r.key)?r.key:[r.key],i="keydown.interface."+r.handle,a=e.map(n,function(e){return"string"==typeof e?e.toUpperCase().charCodeAt(0):e});this.on=function(r){e(document).on(i,function(n){t[n.which]||-1==e.inArray(n.which,a)||(t[n.which]=!0,r(n,"keydown"))})},this.off=function(){e(document).off(i)}};return function(t,n){e.extend(t,new r(n))}}),define("utils/interface/bindings/keyup",["jquery"],function(e){var t=function(t){var r=e.isArray(t.key)?t.key:[t.key],n="keyup.interface."+t.handle,i=e.map(r,function(e){return"string"==typeof e?e.toUpperCase().charCodeAt(0):e});this.on=function(t){e(document).on(n,function(r){-1!==e.inArray(r.which,i)&&t(r,"keyup")})},this.off=function(){e(document).off(n)}};return function(r,n){e.extend(r,new t(n))}}),define("utils/timeout",["underscore"],function(e){return function(){var t=arguments[0],r=e.isArray(arguments[1])?arguments[1]:[],n=e.isFunction(arguments[1])?arguments[1]:arguments[2],i=0;return t?(i=setTimeout(n,t),r.push(i)):n.call(),i}}),define("utils/simpleRandomize",["underscore"],function(e){var t=function(t,r){if(e.isArray(t)){var n=Math.floor(Math.random()*t.length);return t[n]}if(e.isFunction(t))return t.call(r);if(e.isObject(t)){if(!e.isNumber(t.min)||!e.isNumber(t.max)||t.min>t.max)throw new Error("randomization objects need both a max and a minimum property, also max has to be larger than min");return t.min+(t.max-t.min)*Math.random()}return t};return t}),define("utils/interface/bindings/timeout",["utils/timeout","utils/simpleRandomize"],function(e,t){return function(r,n){var i=function(){var r,i=t(n.duration)||0;return{on:function(t){r=e(i,function(){t({},"timeout")})},off:function(){clearTimeout(r)}}}();r.on=i.on,r.off=i.off}}),define("utils/interface/binder",["jquery","./bindings/click","./bindings/keypressed","./bindings/keyup","./bindings/timeout"],function(e,t,r,n,i){return function(a,o){var s=o.on;if("function"==typeof s){if(a.on=o.on,a.off=o.off,"function"!=typeof a.off)throw new Error("Interface off is not a function for "+o.handle);return!0}switch(s){case"keypressed":r(a,o);break;case"keyup":n(a,o);break;case"click":t(a,o);break;case"timeout":i(a,o);break;case"enter":r(a,e.extend({key:13},o));break;case"space":r(a,e.extend({key:32},o));break;case"esc":r(a,e.extend({key:27},o));break;case"leftTouch":o.element=e("<div>").css({position:"absolute",left:0,width:"30%",height:"100%",background:"#00FF00",opacity:.3}),t(a,o);break;case"rightTouch":o.element=e("<div>").css({position:"absolute",right:0,width:"30%",height:"100%",background:"#00FF00",opacity:.3}),t(a,o);break;case"topTouch":o.element=e("<div>").css({position:"absolute",top:0,width:"100%",height:"30%",background:"#00FF00",opacity:.3}),t(a,o);break;case"bottomTouch":o.element=e("<div>").css({position:"absolute",bottom:0,width:"100%",height:"30%",background:"#00FF00",opacity:.3}),t(a,o);break;default:throw new Error('You have an input element without a recognized "on" property: '+s)}return!0}}),define("utils/interface/triggerEvent",["utils/pubsub"],function(e){return function(t,r,n,i){var a={timestamp:+new Date,latency:i,handle:n.handle,type:r,e:t};e.publish("input",[a])}}),define("utils/interface/listener",["./binder","./triggerEvent"],function(e,t){return function(r,n){this.handle=r.handle,e(this,r),this.on(function(e,i){t(e,i,r,n.getLatency())}),this.destroy=this.off}}),define("utils/now",[],function(){var e;return window.performance&&(e=performance.now||performance.mozNow||performance.webkitNow||performance.msNow||performance.oNow),e?function(){return e.apply(performance)}:function(){return+new Date}}),define("utils/interface/interface",["jquery","./listener","../is_touch","../now"],function(e,t,r,n){var i=[],a=0;return{getLatency:function(){return n()-a},resetTimer:function(){a=n()},add:function(n){if(!n)throw new Error("Missing input element. Could not add input listener");var a=this,o=e.isArray(n)?n:[n];e.each(o,function(e,n){if("undefined"!=typeof n.touch){if(r&&!n.touch)return!0;if(!r&&n.touch)return!0}var o=new t(n,a);i.push(o)})},remove:function(t){t=e.isArray(t)?t:[t];for(var r=i.length-1;r>=0;r--){var n=i[r];-1!=e.inArray(n.handle,t)&&(n.off(),i.splice(r,1))}},destroy:function(){for(var e in i)i[e].destroy();i=[]}}}),define("models/model",["backbone","underscore"],function(e,t){"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t});var r=e.Model.extend({constructor:function(r,n){var i={};t.each(r,function(e,r){if(t.isObject(e)){var n=Object.create(e),a=this.defaults&&this.defaults[r]&&t.isObject(this.defaults[r])?this.defaults[r]:{};i[r]=t.defaults(n,a)}else i[r]=e},this),e.Model.apply(this,[i,n])}});return r}),define("app/media/media_view",["jquery","backbone","app/task/main_view"],function(e,t,r){var n=r.$el,i=t.View.extend({initialize:function(t){this.options=t||{},this.$el.addClass("stimulus").attr("data-handle",this.model.handle).css("visibility","hidden").css(this.model.get("css")).appendTo(n),e.when(this.options.promise).then(e.proxy(this.render,this))},render:function(){return this.size(),this.place(),this},show:function(){return"image"===this.options.type&&-1!==this.options.image.indexOf("gif")?(window.ActiveXObject||"ActiveXObject"in window?(this.$el.css("visibility","visible"),this.$el[0].src=this.options.image+"#"+Math.random()):(this.$el[0].src="",this.$el[0].src=this.options.image,this.$el.css("visibility","visible")),this):(this.$el.css("visibility","visible"),this)},hide:function(){return this.$el.css("visibility","hidden"),this},size:function(){var e=this.model.get("size");return e.font_size&&this.$el.css("font-size",e.font_size),"auto"!=e.height&&"word"!=this.options.type&&this.$el.height(e.height+"%"),"auto"!=e.width&&this.$el.width(e.width+"%"),this},place:function(){function e(e){return{height:e.outerHeight(),width:e.outerWidth()}}var t,r,i,a,o=e(n),s=e(this.$el),u=this.model.get("location")||{};switch("undefined"==typeof u.top&&"undefined"==typeof u.bottom&&(u.top="center"),"undefined"==typeof u.left&&"undefined"==typeof u.right&&(u.right="center"),u.top){case void 0:case"auto":t="auto";break;case"center":t=(o.height-s.height)/2;break;default:t=o.height*u.top/100}switch(u.bottom){case void 0:case"auto":r="auto";break;case"center":r=(o.height-s.height)/2;break;default:r=o.height*u.bottom/100}switch(u.left){case void 0:case"auto":i="auto";break;case"center":i=(o.width-s.width)/2;break;default:i=o.width*u.left/100}switch(u.right){case void 0:case"auto":a="auto";break;case"center":a=(o.width-s.width)/2;break;default:a=o.width*u.right/100}this.$el.css({top:t,bottom:r,left:i,right:a})}});return i}),define("app/global",["require","underscore"],function(e){function t(e,i){return i?n=e:(r.isPlainObject(e)&&(r.each(function(e,r){console.warn&&t[r]&&console.warn('Overwriting "'+r+'" in global object.')}),r.merge(n,e)),n)}window.piGlobal||(window.piGlobal={});var r=e("underscore"),n=window.piGlobal;return t}),define("app/inflator",["jquery","./trial/trial_sets","./stimulus/stimulus_sets","./media/media_sets","./global"],function(e,t,r,n,i){var a=function(e){return"function"==typeof e.customize&&e.customize.apply(e,[e,i()]),e},o=function(i,s,u){var c,l,d,p;switch(s){case"trial":c=t();break;case"stimulus":c=r();break;case"media":c=n();break;default:throw new Error("Unknown set type "+s)}if(!i.inherit)return!u&&a(i),i;if(l=e.isPlainObject(i.inherit)?i.inherit:{set:i.inherit},!c[l.set])throw new Error("Unknown "+s+"Set: "+l.set);return d=o(c[l.set].inherit(l),s,!0),p=e.extend(!0,{},i),e.each(d,function(t,r){p[t]||(p[t]=e.isArray(d[t])?e.extend(!0,[],r):"object"==typeof d[t]?e.extend(!0,{},r):r)}),d.data&&(p.data=e.extend(!0,{},d.data,p.data)),!u&&a(p),p};return o}),define("utils/html",["jquery","underscore"],function(e,t){var r=function(r,n){var i=e.Deferred();if(r.word)r.displayType="element",r.type="word",r.el=e("<div>",{text:r.word});else if(r.image)r.displayType="element",r.type="image",r.promise=i.promise(),r.el=e("<img>").on("load",function(){i.resolve()}).attr("src",r.image);else if(r.jquery)r.displayType="element",r.type="jquery",r.el=r.jquery;else if(r.html)r.displayType="element",r.type="html",r.el=e(t.template(r.html,n||{}));else if(r.template){var a=require("text!"+r.template);r.displayType="element",r.type="html";try{r.el=e(t.template(a,n||{}))}catch(o){throw new Error("Templates must be wrapped in an html element such as <span></span>. "+r.inlineTemplate+" is invalid")}}else{if(!r.inlineTemplate)return!1;r.displayType="element",r.type="html";try{r.el=e(t.template(r.inlineTemplate,n||{}))}catch(o){throw new Error("Templates must be wrapped in an html element such as <span></span>. "+r.inlineTemplate+" is invalid")}}};return r}),define("app/media/media_constructor",["jquery","./media_view","../inflator","utils/html","app/task/build_url","app/global"],function(e,t,r,n,i,a){return function(o,s){if("string"==typeof o&&(o={word:o}),!o)throw new Error("Media object not defined for "+s.name());var u=r(o,"media");return u.template&&(u.template=i(u.template,"template")),u.image&&(u.image=i(u.image,"image")),u.source=e.extend({},u),u.model=s,n(u,{global:a(),trialData:s.trial.data,stimulusData:s.get("data")}),new t(u)}}),define("app/stimulus/stimulus_model",["require","models/model","app/media/media_constructor","utils/pubsub","underscore","utils/is_touch","app/task/settings"],function(e){var t=e("models/model"),r=e("app/media/media_constructor"),n=e("utils/pubsub"),i=e("underscore"),a=e("utils/is_touch"),o=e("app/task/settings"),s=t.extend({initialize:function(){this.collection.trial&&(this.trial=this.collection.trial),this.attributes.data=this.attributes.data||{},this.attributes.data.handle=this.attributes.data.handle||this.attributes.handle,this.handle=this.attributes.data.handle;var e=this.get(a&&this.get("touchMedia")?"touchMedia":"media");this.media=new r(e,this)},defaults:{size:{height:"auto",width:"auto"},css:{}},activate:function(){var e=this,t=this.handle;this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],n.subscribe("stim:start",e.pubsubStack,function(r){return i.include([t,"All"],r)?void e.media.show():!1}),n.subscribe("stim:setAttr",e.pubsubStack,function(r,n){if(!i.include([t,"All"],r))return!1;if(i.isFunction(n))n.apply(e);else{var a=e.get("data")||{};a=i.extend(a,n),e.set("data",a)}}),n.subscribe("stim:stop",e.pubsubStack,function(r){return i.include([t,"All"],r)?void e.media.hide():!1})},disable:function(){this.media.hide(),this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],i.each(this.pubsubStack,function(e){n.unsubscribe(e)}),this.timeStack=[],this.pubsubStack=[]},name:function(){var e=this.attributes;return e.data.alias?e.data.alias:e.inherit&&e.inherit.set?e.inherit.set:e.handle?e.handle:!1},mediaName:function(){var e=this.media.options.source,t=o.logger&&o.logger.fullpath;if(e.alias)return e.alias;for(var r in e)if("inherit"!=r)return i.contains(["image","template"],r)&&!t?e[r].replace(/^.*[\\\/]/,""):e[r]}});return s}),define("app/stimulus/stimulus_constructor",["./stimulus_model","../inflator"],function(e,t){return function(r,n){var i=t(r,"stimulus");return i.source=r,new e(i,n)}}),define("app/stimulus/stimulus_collection",["backbone","underscore","app/stimulus/stimulus_constructor"],function(e,t,r){var n=e.Collection.extend({model:r,initialize:function(e,t){t||(t={}),this.trial=t.trial},whereData:function(e){return t.isEmpty(e)?[]:this.filter(function(t){var r=t.get("data")||{};for(var n in e)if(e[n]!==r[n])return!1;return!0})},activate:function(){return this.each(function(e){e.activate()}),this},disable:function(){return this.each(function(e){e.disable()}),this},display_all:function(){this.each(function(e){e.media.show()})},hide_all:function(){this.each(function(e){e.media.hide()})},refresh:function(){this.each(function(e){e.media.render()})},get_stimlist:function(){return this.chain().filter(function(e){return!e.get("nolog")}).map(function(e,t){return e.name()||"stim"+t}).value()},get_medialist:function(){return this.chain().filter(function(e){return!e.get("nolog")}).map(function(e,t){return e.mediaName()||"media"+t}).value()}});return n}),define("app/trial/evaluate",["underscore","app/global","./current_trial"],function(e,t,r){return function(n,i){var a=t(),o=r();if(!n)throw new Error("There is an interaction without conditions!!");n=e.isArray(n)?n:[n],i=i||{};var s=!0;if("begin"==i.type){var u=e.reduce(n,function(e,t){return e||"begin"==t.type},!1);if(!u)return!1}return e.each(n,function(t){var r,n,u=!0;switch(t.type){case"begin":"begin"!==i.type&&(u=!1);break;case"inputEquals":e.isArray(t.value)||(t.value=[t.value]),-1===e.indexOf(t.value,i.handle)&&(u=!1);break;case"inputEqualsTrial":i.handle!==o.data[t.property]&&(u=!1);break;case"inputEqualsStim":r={},t.handle&&(r.handle=t.handle),r[t.property]=i.handle,n=o._stimulus_collection.whereData(r),0===n.length&&(u=!1);break;case"inputEqualsGlobal":if("undefined"==typeof t.property)throw new Error('inputEqualsGlobal requires both "property" to be defined');i.handle!==a[t.property]&&(u=!1);break;case"trialEquals":if("undefined"==typeof t.property||"undefined"==typeof t.value)throw new Error('trialEquals requires both "property" and "value" to be defined');t.value!==o.data[t.property]&&(u=!1);break;case"globalEquals":if("undefined"==typeof t.property||"undefined"==typeof t.value)throw new Error('globalEquals requires both "property" and "value" to be defined');
t.value!==a[t.property]&&(u=!1);break;case"globalEqualsTrial":if("undefined"==typeof t.globalProp||"undefined"==typeof t.trialProp)throw new Error('globalEqualsTrial requires both "globalProp" and "trialProp" to be defined');a[t.globalProp]!==o.data[t.trialProp]&&(u=!1);break;case"globalEqualsStim":if("undefined"==typeof t.globalProp||"undefined"==typeof t.stimProp)throw new Error('globalEqualsStim requires both "globalProp" and "stimProp" to be defined');r={},t.handle&&(r.handle=t.handle),r[t.stimProp]=a[t.globalProp],n=o._stimulus_collection.whereData(r),0===n.length&&(u=!1);break;case"function":t.value.apply(o,[o,i])||(u=!1);break;default:throw new Error("Unknown condition type: "+t.type)}s=s&&(t.negate?!u:u)}),s}}),define("app/trial/action_list",["underscore","utils/pubsub","utils/interface/interface","app/global"],function(e,t,r,n){var i={showStim:function(e){var r=e.handle||e;t.publish("stim:start",[r])},hideStim:function(e){var r=e.handle||e;t.publish("stim:stop",[r])},setStimAttr:function(e){var r=e.handle,n=e.setter;t.publish("stim:setAttr",[r,n])},setTrialAttr:function(e,r){if("undefined"==typeof e.setter)throw new Error("The setTrialAttr action requires a setter property");t.publish("trial:setAttr",[e.setter,r])},setInput:function(e){if("undefined"==typeof e.input)throw new Error("The setInput action requires an input property");t.publish("trial:setInput",[e.input])},trigger:function(e){if("undefined"==typeof e.handle)throw new Error("The trigger action requires a handle property");t.publish("trial:setInput",[{handle:e.handle,on:"timeout",duration:+e.duration||0}])},removeInput:function(e){if("undefined"==typeof e.handle)throw new Error("The removeInput action requires a handle property");t.publish("trial:removeInput",[e.handle])},"goto":function(e){t.publish("trial:goto",[e])},endTrial:function(){t.publish("trial:end")},resetTimer:function(e,t){t.latency=0,r.resetTimer()},log:function(e,r){t.publish("log",[e,r])},setGlobalAttr:function(t){switch(typeof t.setter){case"function":t.setter.apply(null,[n(),t]);break;case"object":e.extend(n(),t.setter);break;default:throw new Error('setGlobalAttr requires a "setter" property')}},custom:function(e,t){if("function"!=typeof e.fn)throw new Error("The custom action requires a fn propery");e.fn.apply(null,[e,t,n()])}};return i}),define("app/trial/action",["jquery","./action_list"],function(e,t){return function(r,n){var i=!0;if(!r)throw new Error("There is an interaction without actions!!");return r=e.isArray(r)?r:[r],e.each(r,function(e,r){if(!t[r.type])throw new Error("unknown action: "+r.type);"endTrial"===r.type&&(i=!1),t[r.type](r,n)}),i}}),define("app/trial/interactions",["jquery","utils/pubsub","./evaluate","./action"],function(e,t,r,n){var i=[],a=function(t,i){e.each(t,function(e,t){return r(t.conditions,i)?n(t.actions,i):void 0})};return{activate:function(e){t.subscribe("input",i,function(t){a(e,t)}),a(e,{type:"begin",latency:0})},disable:function(){e.each(i,function(){t.unsubscribe(this)})}}}),define("app/trial/trial_constructor",["require","jquery","underscore","utils/pubsub","utils/interface/interface","app/stimulus/stimulus_collection","./interactions","./current_trial","../inflator","app/task/main_view"],function(e){var t=e("jquery"),r=e("underscore"),n=e("utils/pubsub"),i=e("utils/interface/interface"),a=e("app/stimulus/stimulus_collection"),o=e("./interactions"),s=e("./current_trial"),u=e("../inflator"),c=e("app/task/main_view"),l=0,d=function(e){var n=u(e,"trial");if(r.extend(this,n),this.data||(this.data={}),this._source=n,this._id=r.uniqueId("trial_"),this.counter=l++,!this.interactions)throw new Error("Interactions not defined");this._layout_collection=new a(this.layout||[],{trial:this}),this._stimulus_collection=new a(this.stimuli||[],{trial:this}),this._pubsubStack=[],this._next=["next",{}],this.deferred=t.Deferred()};return r.extend(d.prototype,{activate:function(){var e=this;return s(this),this._layout_collection.display_all(),n.subscribe("trial:end",this._pubsubStack,r.bind(this.deactivate,this)),n.subscribe("trial:setAttr",this._pubsubStack,function(t,n){r.isFunction(t)?t.apply(e,[e.data,n]):r.extend(e.data,t)}),n.subscribe("trial:setInput",this._pubsubStack,function(e){i.add(e)}),n.subscribe("trial:removeInput",this._pubsubStack,function(e){"All"==e||r.include(e,"All")?i.destroy():i.remove(e)}),n.subscribe("trial:goto",this._pubsubStack,function(t){e._next=[t.destination,t.properties||{}]}),i.add(this.input||[]),this._stimulus_collection.activate(),i.resetTimer(),o.activate(this.interactions),this.deferred.promise()},deactivate:function(){var e=this;i.destroy(),this._stimulus_collection.disable(),o.disable(),r.each(this._pubsubStack,function(e){n.unsubscribe(e)}),this._pubsubStack=[],s(void 0),document.all&&!document.addEventListener?setTimeout(function(){c.empty(),e.deferred.resolve(e._next[0],e._next[1])},1):(c.empty(),e.deferred.resolve(e._next[0],e._next[1]))},name:function(){return this.data.alias?this.data.alias:this.inherit&&this.inherit.set?this.inherit.set:!1}}),d}),define("app/task/log/post",["jquery","app/task/settings"],function(e,t){var r=function(r){var n=t(),i=n.logger&&n.logger.url,a=e.Deferred();if(!i)return a.resolve();var o={json:JSON.stringify(r)||""};return e.extend(o,n.metaData||{}),a=e.post(i,o),a=a.then(null,function(){return e.post(i,o)})};return r}),define("app/task/log/log_stack",["require","app/global"],function(e){var t=e("app/global");return function(){return t().current.logs}}),define("app/task/log/logger",["require","jquery","utils/pubsub","app/trial/current_trial","app/task/settings","./post","./log_stack"],function(e){function t(e,t,r,n){var i=this._stimulus_collection.get_stimlist(),a=this._stimulus_collection.get_medialist();return{log_serial:n.length,trial_id:this.counter,name:this.name(),responseHandle:t.handle,latency:Math.floor(t.latency),stimuli:i,media:a,data:e}}function r(){var e,t=u();return t.length-c<=0?l:(e=t.slice(c,t.length),c=t.length,n.when(l,s(e)))}var n=e("jquery"),i=e("utils/pubsub"),a=e("app/trial/current_trial"),o=e("app/task/settings"),s=e("./post"),u=e("./log_stack"),c=0,l=n.Deferred().resolve();return i.subscribe("log",function(e,r){var i=u(),s=o().logger||{},c=s.logger?s.logger:t,l=a(),d=c.apply(l,[l.data,r,e,i]);if(s.meta){if(!n.isPlainObject(s.meta))throw new Error("LOGGER: logger.meta must be an object but instead was a "+typeof s.meta);n.extend(d,s.meta)}i.push(d)}),i.subscribe("log:send",function(){var e=u(),t=o().logger&&o().logger.pulse;t&&e.length-c>=t&&r()}),r}),define("app/sequencer/player",["require","jquery","./sourceSequence","./trialSequence","app/trial/trial_constructor","app/task/log/logger","app/task/settings","utils/pubsub"],function(e){function t(e,c){var l,d;switch(e){case"nextWhere":l=n.nextWhere(c);break;case"previousWhere":l=n.lastWhere(c);break;case"current":l=n.current();break;case"first":l=n.first();break;case"last":l=n.last();break;case"end":l=n.end();break;case"next":default:l=n.next()}l?(d=new a(n.current()),d.activate().done(function(){u.publish("log:send"),t.apply(null,arguments)}),u.publish("trial:activated",[d]),i.add(d)):o().always(function(){var e=s("hooks")||{};return r.when(e.endTask&&e.endTask())}).always(s("$done"))}var r=e("jquery"),n=e("./sourceSequence"),i=e("./trialSequence"),a=e("app/trial/trial_constructor"),o=e("app/task/log/logger"),s=e("app/task/settings"),u=e("utils/pubsub");return t}),define("activatePIP",["require","underscore","app/task/script","app/task/main_view","app/task/parser","app/sequencer/player","app/global"],function(e){function t(e,t){var u=e.settings||(e.settings={});u.$done=t||function(){window.location.href=u.redirect||window.location.href};var c=s(s()),l=e.name||"anonymous PIP";c[l]&&console.warn&&console.warn('The task "'+l+'" already exists. Overwriting it...'),c[l]=c.current=r.isPlainObject(e.current)?e.current:{},c.current.logs||(c.current.logs=[]),n(e);var d=a();i.activate().docReady().done(function(){i.loading(d).done(function(){i.empty(),o()}).fail(function(e){throw new Error("loading resource failed, do something about it! (you can start by checking the error log, you are probably reffering to the wrong url - "+e+")")})})}var r=e("underscore"),n=e("app/task/script"),i=e("app/task/main_view"),a=e("app/task/parser"),o=e("app/sequencer/player"),s=e("app/global");return t}),define("pipScorer/computeD",["jquery"],function(e){function t(){e.extend(this,{dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}})}return e.extend(t.prototype,{setComputeObject:function(t){e.extend(this,t)},setDataArray:function(){var e=window.piGlobal;this.dataArray=e.current.logs}}),t}),define("pipScorer/msgMan",["underscore"],function(e){function t(){this.messages=e.extend({},r)}var r={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."};return e.extend(t.prototype,{setMsgObject:function(t){e.extend(this.messages,t)},getScoreMsg:function(t){var r=this.messages.MessageDef;if(!r||!r.length)throw new Error('You must define a "MessageDef" array.');var n=parseFloat(t),i=null,a=null,o="error: msg was not set",s=!1;if(e.each(r,function(e){i=parseFloat(e.cut),a=e.message,i>=n&&!s&&(o=a,s=!0)}),!s){var u=r.length,c=r[u-1];o=c.message}return o},getMessage:function(e){return this.messages[e]}}),t}),define("pipScorer/parcelMng",["underscore"],function(e){function t(e){this.parcelArray=[],this.scoreData={},this.msgMan=e}return e.extend(t.prototype,{Init:function(t){var r=this,n=this.msgMan,i=window.piGlobal,a=i.current.logs;r.parcelArray=[],r.scoreData={},r.msgMan=n;var o=t.AnalyzedVar,s=t.ErrorVar,u=t.parcelVar,c=t.parcelValue,l=t.minRT,d=t.maxRT,p=t.fastRT,f=0,h=0,m=0,g=0,b=parseFloat(t.maxFastTrialsRate);if("undefined"==typeof c||0===c.length){m=0,f=0,h=0,g=0;var v={};v.name="general",v.trialIData=[],e.each(a,function(e){e[o]>=l&&e[o]<=d?(m++,1==e.data[s]&&g++,r.validate(v,e,t)&&f++):e[o]<=p&&h++}),r.checkErrors(m,g,t),r.parcelArray[0]=v}else e.each(c,function(n,i){m=0,f=0,h=0,g=0;var c={};c.name=n,c.trialIData=[],e.each(a,function(e){var i=e.data[u];i==n&&(e[o]>=l&&e[o]<=d?(m++,1==e.data[s]&&g++,r.validate(c,e,t)&&f++):e[o]<=p&&h++)}),r.checkErrors(m,g,t),r.parcelArray[i]=c});h/f>b&&(r.scoreData.errorMessage=this.msgMan.getMessage("tooFast"))},checkErrors:function(e,t,r){var n=r.maxErrorParcelRate;t/e>n&&(this.scoreData.errorMessage=this.msgMan.getMessage("manyErrors"))},validate:function(e,t,r){var n=r.errorLatency,i=r.ErrorVar,a=t.data;return"latency"==n.use?(e.trialIData.push(t),!0):"false"==n.use?"1"==a[i]?!1:(e.trialIData.push(t),!0):"penalty"==n.use?(e.trialIData.push(t),!0):void 0},addPenalty:function(t,r){var n=r.errorLatency,i=this;if("penalty"==n.use){var a=parseFloat(n.penalty),o=r.ErrorVar,s=r.AnalyzedVar,u=r.condVar,c=r.cond1VarValues,l=r.cond2VarValues,d=t.trialIData,p=t.avgCon1,f=t.avgCon2;e.each(d,function(e){var t=e.data,r=t[o],n=t[u],d=i.checkArray(n,c),h=i.checkArray(n,l);"1"==r&&(d?e[s]+=p+a:h&&(e[s]+=f+a))})}},avgAll:function(t){var r=this;e.each(r.parcelArray,function(e){r.avgParcel(e,t)})},avgParcel:function(t,r){var n=this,i=t.trialIData,a=r.condVar,o=r.cond1VarValues,s=r.cond2VarValues,u=r.AnalyzedVar,c=0,l=0,d=0,p=0,f=0,h=0;e.each(i,function(e){var t=e[u],r=e.data;d+=t,h++;var i=r[a],m=n.checkArray(i,o),g=n.checkArray(i,s);m?(p++,c+=t):g&&(f++,l+=t)}),(2>=p||2>=f)&&(n.scoreData.errorMessage=this.msgMan.getMessage("notEnough")),0!==p&&(c/=p),0!==f&&(l/=f),t.avgCon1=c,t.avgCon2=l,t.diff=t.avgCon1-t.avgCon2,0!==h&&(t.avgBoth=d/h),n.addPenalty(t,r)},checkArray:function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n==e)return!0}return!1},varianceAll:function(t){var r=this;e.each(r.parcelArray,function(e){r.varianceParcel(e,t)})},varianceParcel:function(t,r){var n=this,i=r.AnalyzedVar,a=t.trialIData,o=r.cond1VarValues,s=r.cond2VarValues,u=r.condVar,c=t.avgBoth,l=0,d=0,p=[],f=[],h=[],m=r.errorLatency,g=m.useForSTD;e.each(a,function(e){var t=e.data,a=e[i],c=r.ErrorVar,l=t[c],d=t[u],h=n.checkArray(d,o),m=n.checkArray(d,s);h?g?p.push(a):"0"==l&&p.push(a):m&&(g?f.push(a):"0"==l&&p.push(a))}),h=p.concat(f),e.each(h,function(e){var t=e;l=t-c,d+=l*l}),t.variance=d/(h.length-1)},scoreAll:function(t){var r=this,n=0;e.each(r.parcelArray,function(e){r.scoreParcel(e,t),n+=e.score});var i=n/r.parcelArray.length;r.scoreData.score=i.toFixed(2)},scoreParcel:function(e){var t=this,r=Math.sqrt(e.variance);0===r?(t.scoreData.errorMessage=this.msgMan.getMessage("notEnough"),e.score=e.diff):e.score=e.diff/r}}),t}),define("pipScorer/Scorer",["jquery","./computeD","./msgMan","./parcelMng"],function(e,t,r,n){function i(){this.computeData=new t,this.msgMan=new r,this.parcelMng=new n(this.msgMan)}return!!window.console||(console={log:e.noop,error:e.noop}),console.log||(console.log=function(){}),e.extend(i.prototype,{addSettings:function(e,t){switch(e){case"compute":this.computeData.setComputeObject(t);break;case"message":this.msgMan.setMsgObject(t);break;default:throw new Error('SCORER:addSettings: unknow "type" '+e)}},computeD:function(){var e=this.computeData,t=this.parcelMng;e.setDataArray(),t.Init(e),t.avgAll(e),t.varianceAll(e),t.scoreAll(e);var r=t.scoreData,n={};return void 0===r.errorMessage||null===r.errorMessage?(n.FBMsg=i.getFBMsg(r.score),n.DScore=r.score):(n.FBMsg=r.errorMessage,n.DScore=""),n},postToServer:function(t,r,n,i){var a=this.computeData.postSettings||{},o=a.url,s={};return n||(n=a.score),i||(i=a.msg),s[n]=t,s[i]=r,e.post(o,JSON.stringify(s))},dynamicPost:function(t){var r=this.computeData.postSettings||{},n=r.url;return e.post(n,JSON.stringify(t))},getFBMsg:function(e){var t=this.msgMan.getScoreMsg(e);return t}}),i}),define("pipScorer",["pipScorer/Scorer"],function(e){return e}),define("pipAPI",["require","underscore"],function(e){function t(e){this.script={global:{},current:{},trialSets:{},stimulusSets:{},mediaSets:{},sequence:[]},this.script.name=e||"anonymous PIP",this.settings=this.script.settings={canvas:{maxWidth:800,proportions:.8},hooks:{}}}function r(e){function t(t,r){var i,a=this.script[e+"Sets"]||(this.script[e+"Sets"]={});if(n.isPlainObject(t))n.merge(a,t);else for(n.isArray(r)||(r=[r]),a[t]||(a[t]=[]),i=0;i<r.length;i++)a[t].push(r[i])}return t}var n=e("underscore");return n.extend(t.prototype,{addTrialSets:r("trial"),addStimulusSets:r("stimulus"),addMediaSets:r("media"),addSettings:function(e,t){var r;return n.isPlainObject(t)?(r=this.settings[e]=this.settings[e]||{},n.extend(r,t)):this.settings[e]=t,this},addSequence:function(e){var t=this.script;return n.isArray(e)||(e=[e]),t.sequence=t.sequence.concat(e),this},addGlobal:function(e){if(!n.isPlainObject(e))throw new Error("global must be an object");n.merge(this.global(),e)},getGlobal:function(){return window.piGlobal},addCurrent:function(e){if(!n.isPlainObject(e))throw new Error("current must be an object");n.merge(this.script.current,e)},getCurrent:function(){return this.script.current},addScript:function(e){n.merge(this.script,e)},getScript:function(){return this.script},getLogs:function(){return this.script.current.logs},play:function(){throw new Error("you should return API.script instead of calling API.play()!!")}}),t});
//# sourceMappingURL=activatePIP.js.map