define(["require","./sourceSequence","./trialSequence","app/trial/trial_constructor","app/task/log/logger","app/task/settings","utils/pubsub"],function(e){var t=e("./sourceSequence"),n=e("./trialSequence"),r=e("app/trial/trial_constructor"),i=e("app/task/log/logger"),s=e("app/task/settings"),o=e("utils/pubsub"),u=function(e,a){var f,l;switch(e){case"nextWhere":f=t.nextWhere(a);break;case"previousWhere":f=t.lastWhere(a);break;case"current":f=t.current();break;case"first":f=t.first();break;case"last":f=t.last();break;case"end":f=t.end();break;case"next":default:f=t.next()}f?(l=new r(t.current()),l.activate().done(function(){o.publish("log:send"),u.apply(null,arguments)}),o.publish("trial:activated",[l]),n.add(l)):i().always(function(){s.hooks.endTask?s.hooks.endTask.call():window.location.href=s.redirect||window.location.href})};return u});