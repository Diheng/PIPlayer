define(["underscore","utils/preloader","app/task/build_url"],function(e,t,n){var r=function(r){e.isUndefined(r.image)||t.add(n(r.image,"image"),"image"),e.isUndefined(r.template)||t.add(n(r.template,"template"),"template")},i=function(e){e.media&&r(e.media)},s=function(e){e.element&&r(e.element)},o=function(t){e.each(t.layout||[],i),e.each(t.stimuli||[],i),e.each(t.input||[],s)},u=function(t){e.each(t,function(t){e.isUndefined(t.mixer)?o(t):u(t.data)})},a=function(t){e.each(t.mediaSets||[],function(t){e.each(t,r)}),e.each(t.stimulusSets||[],function(t){e.each(t,i)}),e.each(t.trialSets||[],function(t){e.each(t,o)}),u(t.sequence)};return function(e,n,s){s&&t.reset();switch(n){case"media":r(e);break;case"stimulus":i(e);break;case"trial":o(e);break;case"script":default:a(e)}return t.activate()}});