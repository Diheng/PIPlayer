define(["require","models/model","app/media/media_constructor","utils/pubsub","underscore","utils/is_touch","app/task/settings"],function(e){var t=e("models/model"),n=e("app/media/media_constructor"),r=e("utils/pubsub"),i=e("underscore"),s=e("utils/is_touch"),o=e("app/task/settings"),u=t.extend({initialize:function(){this.collection.trial&&(this.trial=this.collection.trial),this.attributes.data=this.attributes.data||{},this.attributes.data.handle=this.attributes.data.handle||this.attributes.handle,this.handle=this.attributes.data.handle;var e=s&&this.get("touchMedia")?this.get("touchMedia"):this.get("media");this.media=new n(e,this)},defaults:{size:{height:"auto",width:"auto"},css:{}},activate:function(){var e=this,t=this.handle;this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],r.subscribe("stim:start",e.pubsubStack,function(n){if(!i.include([t,"All"],n))return!1;e.media.show()}),r.subscribe("stim:setAttr",e.pubsubStack,function(n,r){if(!i.include([t,"All"],n))return!1;if(i.isFunction(r))r.apply(e);else{var s=e.get("data")||{};s=i.extend(s,r),e.set("data",s)}}),r.subscribe("stim:stop",e.pubsubStack,function(n){if(!i.include([t,"All"],n))return!1;e.media.hide()})},disable:function(){this.media.hide(),this.timeStack=this.timeStack||[],this.pubsubStack=this.pubsubStack||[],i.each(this.pubsubStack,function(e){r.unsubscribe(e)}),this.timeStack=[],this.pubsubStack=[]},name:function(){var e=this.attributes;return e.data.alias?e.data.alias:e.inherit&&e.inherit.set?e.inherit.set:e.handle?e.handle:!1},mediaName:function(){var e=this.media.options.source,t=o.logger&&o.logger.fullpath;if(e.alias)return e.alias;for(var n in e)if(n!="inherit")return i.contains(["image","template"],n)&&!t?e[n].replace(/^.*[\\\/]/,""):e[n]}});return u});