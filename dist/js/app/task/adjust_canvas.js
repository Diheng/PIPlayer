define(["jquery","app/task/script","app/trial/current_trial"],function(e,t,n){var r=function(){var i=this,s=t.settings.canvas||{},o;if(s.proportions)if(e.isPlainObject(s.proportions)){if(typeof s.proportions.height!="number"||typeof s.proportions.width!="number")throw new Error("The canvas proportions object`s height and a width properties must be numeric");o=s.proportions.height/s.proportions.width}else o=s.proportions;setTimeout(function(){var t,r,u={width:e(window).innerWidth(),height:e(window).innerHeight()},a=u.height,f=Math.min(s.maxWidth,u.width);a>o*f?(t=f*o,r=f):(t=a,r=a/o),t-=parseInt(i.$el.css("border-top-width"),10)+parseInt(i.$el.css("border-bottom-width"),10)+parseInt(i.$el.css("margin-top"),10),r-=parseInt(i.$el.css("border-left-width"),10)+parseInt(i.$el.css("border-right-width"),10),i.$el.width(r),i.$el.height(t),i.$el.css("font-size",t*(s.textSize||3)/100),n()&&(n()._layout_collection.refresh(),n()._stimulus_collection.refresh()),window.scrollTo(0,1)},500)};return r});