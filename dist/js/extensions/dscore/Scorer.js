define("extensions/dscore/computeD",["jquery"],function(r){var a={dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}};return r.extend(a,{setComputeObject:function(a){r.extend(this,a)},setDataArray:function(){var r=window.piGlobal;this.dataArray=r.current.logs}}),a}),define("extensions/dscore/msgMan",["jquery","underscore"],function(r,a){var e={MessageDef:[],manyErrors:"There were too many errors made to determine a result.",tooFast:"There were too many fast trials to determine a result.",notEnough:"There were not enough trials to determine a result."},n={setMsgObject:function(a){r.extend(e,a)},getScoreMsg:function(r){var n=e.MessageDef;if(!n||!n.length)throw new Error('You must define a "MessageDef" array.');var t=parseFloat(r),o=null,c=null,s="error: msg was not set",l=!1;if(a.each(n,function(r){o=parseFloat(r.cut),c=r.message,o>=t&&!l&&(s=c,l=!0)}),!l){var i=n.length,u=n[i-1];s=u.message}return s},getMessage:function(r){return e[r]}};return n}),define("extensions/dscore/parcelMng",["jquery","underscore","./msgMan"],function(r,a,e){var n=window.piGlobal,t={};return r.extend(t,{parcelArray:[],scoreData:{},Init:function(r){var o=n.current.logs;t.parcelArray=[],t.scoreData={};var c=r.AnalyzedVar,s=r.ErrorVar,l=r.parcelVar,i=r.parcelValue,u=r.minRT,d=r.maxRT,g=r.fastRT,f=0,v=0,y=0,h=0,p=parseFloat(r.maxFastTrialsRate);if("undefined"==typeof i||0===i.length){y=0,f=0,v=0,h=0;var V={};V.name="general",V.trialIData=[],a.each(o,function(a){a[c]>=u&&a[c]<=d?(y++,1==a.data[s]&&h++,t.validate(V,a,r)&&f++):a[c]<=g&&v++}),t.checkErrors(y,h,r),t.parcelArray[0]=V}else a.each(i,function(e,n){y=0,f=0,v=0,h=0;var i={};i.name=e,i.trialIData=[],a.each(o,function(a){var n=a.data[l];n==e&&(a[c]>=u&&a[c]<=d?(y++,1==a.data[s]&&h++,t.validate(i,a,r)&&f++):a[c]<=g&&v++)}),t.checkErrors(y,h,r),t.parcelArray[n]=i});v/f>p&&(t.scoreData.errorMessage=e.getMessage("tooFast"))},checkErrors:function(r,a,n){var o=n.maxErrorParcelRate;a/r>o&&(t.scoreData.errorMessage=e.getMessage("manyErrors"))},validate:function(r,a,e){var n=e.errorLatency,t=e.ErrorVar,o=a.data;return"latency"==n.use?(r.trialIData.push(a),!0):"false"==n.use?"1"==o[t]?!1:(r.trialIData.push(a),!0):"penalty"==n.use?(r.trialIData.push(a),!0):void 0},addPenalty:function(r,e){var n=e.errorLatency;if("penalty"==n.use){var o=parseFloat(n.penalty),c=e.ErrorVar,s=e.AnalyzedVar,l=e.condVar,i=e.cond1VarValues,u=e.cond2VarValues,d=r.trialIData,g=r.avgCon1,f=r.avgCon2;a.each(d,function(r){var a=r.data,e=a[c],n=a[l],d=t.checkArray(n,i),v=t.checkArray(n,u);"1"==e&&(d?r[s]+=g+o:v&&(r[s]+=f+o))})}},avgAll:function(r){a.each(t.parcelArray,function(a){t.avgParcel(a,r)})},avgParcel:function(r,n){var o=r.trialIData,c=n.condVar,s=n.cond1VarValues,l=n.cond2VarValues,i=n.AnalyzedVar,u=0,d=0,g=0,f=0,v=0,y=0;a.each(o,function(r){var a=r[i],e=r.data;g+=a,y++;var n=e[c],o=t.checkArray(n,s),h=t.checkArray(n,l);o?(f++,u+=a):h&&(v++,d+=a)}),(2>=f||2>=v)&&(t.scoreData.errorMessage=e.getMessage("notEnough")),0!==f&&(u/=f),0!==v&&(d/=v),r.avgCon1=u,r.avgCon2=d,r.diff=r.avgCon1-r.avgCon2,0!==y&&(r.avgBoth=g/y),t.addPenalty(r,n)},checkArray:function(r,a){for(var e=0;e<a.length;e++){var n=a[e];if(n==r)return!0}return!1},varianceAll:function(r){a.each(t.parcelArray,function(a){t.varianceParcel(a,r)})},varianceParcel:function(r,e){var n=e.AnalyzedVar,o=r.trialIData,c=e.cond1VarValues,s=e.cond2VarValues,l=e.condVar,i=r.avgBoth,u=0,d=0,g=[],f=[],v=[],y=e.errorLatency,h=y.useForSTD;a.each(o,function(r){var a=r.data,o=r[n],i=e.ErrorVar,u=a[i],d=a[l],v=t.checkArray(d,c),y=t.checkArray(d,s);v?h?g.push(o):"0"==u&&g.push(o):y&&(h?f.push(o):"0"==u&&g.push(o))}),v=g.concat(f),a.each(v,function(r){var a=r;u=a-i,d+=u*u}),r.variance=d/(v.length-1)},scoreAll:function(r){var e=0;a.each(t.parcelArray,function(a){t.scoreParcel(a,r),e+=a.score});var n=e/t.parcelArray.length;t.scoreData.score=n.toFixed(2)},scoreParcel:function(r){var a=Math.sqrt(r.variance);0===a?(t.scoreData.errorMessage=e.getMessage("notEnough"),r.score=r.diff):r.score=r.diff/a},simulateOldCode:function(r){var e=[],n=[2,3,5,6],o=r.cond1VarValues,c=r.cond2VarValues,s=r.condVar,l=r.ErrorVar,i=r.AnalyzedVar,u=t.parcelArray[0],d=t.parcelArray[1],g=u.trialIData,f=d.trialIData;a.each(g,function(r){var a=r.data,u=a[s],d=t.checkArray(u,o),g=t.checkArray(u,c),f={};d?(f.block=n[0],f.lat=r[i],f.err=a[l]):g&&(f.block=n[2],f.lat=r[i],f.err=a[l]),e.push(f)}),a.each(f,function(r){var a=r.data,u=a[s],d=t.checkArray(u,o),g=t.checkArray(u,c),f={};d?(f.block=n[1],f.lat=r[i],f.err=a[l]):g&&(f.block=n[3],f.lat=r[i],f.err=a[l]),e.push(f)});var v=t.scoreTask(e,n);return v}}),t}),define("extensions/dscore/Scorer",["jquery","underscore","./computeD","./msgMan","./parcelMng"],function(r,a,e,n,t){window.console||(window.console={log:r.noop,error:r.noop});var o={};return r.extend(o,{addSettings:function(r,a){"compute"==r?e.setComputeObject(a):"message"==r&&n.setMsgObject(a)},init:function(){!!window.console||(console={}),console.log||(console.log=function(){})},computeD:function(){o.init(),e.setDataArray(),t.Init(e),t.avgAll(e),t.varianceAll(e),t.scoreAll(e);var r=t.scoreData,a={};return void 0===r.errorMessage||null===r.errorMessage?(a.FBMsg=o.getFBMsg(r.score),a.DScore=r.score):(a.FBMsg=r.errorMessage,a.DScore=""),a},getInfo:function(){},postToServer:function(a,n,t,o){var c=e.postSettings||{},s=c.url;t||(t=c.score),o||(o=c.msg);var l={};return l[t]=a,l[o]=n,r.post(s,JSON.stringify(l))},dynamicPost:function(a){var n=e.postSettings||{},t=n.url;return r.post(t,JSON.stringify(a))},getFBMsg:function(r){var a=n.getScoreMsg(r);return a}}),o});
//# sourceMappingURL=Scorer.js.map