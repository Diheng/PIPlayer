/*!
 * PIPlayer v0.1.2
 *  License
 */

define("extensions/dscore/computeD",["jquery","app/API"],function(e,t){var n={dataArray:{},AnalyzedVar:"latency",ErrorVar:"error",condVar:"",cond1VarValues:[],cond2VarValues:[],parcelVar:"",parcelValue:[],fastRT:300,maxFastTrialsRate:.1,minRT:400,maxRT:1e4,maxErrorParcelRate:.4,errorLatency:{use:"latency",penalty:600,useForSTD:!0},postSettings:{}};return e.extend(n,{setComputeObject:function(t){e.extend(this,t)},setDataArray:function(){this.dataArray=t.getLogs()}}),n}),define("extensions/dscore/msgCat",["jquery","underscore"],function(e,t){var n={mesCatArray:[]};return e.extend(n,{setMsgObject:function(e){this.mesCatArray=e.MessageDef},getMsg:function(e){var n=this.mesCatArray,r=parseFloat(e),i=null,s=null,o="error: msg was not set",u=!1;t.each(n,function(e){i=parseFloat(e.cut),s=e.message,r<=i&&!u&&(o=s,u=!0)});if(!u){var a=n.length,f=n[a-1];o=f.message}return o}}),n}),define("extensions/dscore/parcelMng",["jquery","app/API","underscore"],function(e,t,n){var r={};return e.extend(r,{parcelArray:[],scoreData:{},Init:function(e){var i=t.getLogs();r.parcelArray=[],r.scoreData={};var s=e.AnalyzedVar,o=e.ErrorVar,u=e.parcelVar,a=e.parcelValue,f=e.minRT,l=e.maxRT,c=e.fastRT,h=0,p=0,d=0,v=0,m=parseFloat(e.maxFastTrialsRate);if(typeof a=="undefined"||a.length===0){d=0,h=0,p=0,v=0;var g={};g.name="general",g.trialIData=[],n.each(i,function(t){t[s]>=f&&t[s]<=l?(d++,t.data[o]==1&&v++,r.validate(g,t,e)&&h++):t[s]<=c&&p++}),r.checkErrors(d,v,e),r.parcelArray[0]=g}else n.each(a,function(t,a){d=0,h=0,p=0,v=0;var m={};m.name=t,m.trialIData=[],n.each(i,function(n){var i=n.data[u];i==t&&(n[s]>=f&&n[s]<=l?(d++,n.data[o]==1&&v++,r.validate(m,n,e)&&h++):n[s]<=c&&p++)}),r.checkErrors(d,v,e),r.parcelArray[a]=m});p/h>m&&(r.scoreData.errorMessage="Too many fast trials")},checkErrors:function(e,t,n){var i=n.maxErrorParcelRate;t/e>i&&(r.scoreData.errorMessage="Too many errors")},validate:function(e,t,n){var r=n.errorLatency,i=n.ErrorVar,s=t.data;if(r.use=="latency")return e.trialIData.push(t),!0;if(r.use=="false")return s[i]=="1"?!1:(e.trialIData.push(t),!0);if(r.use=="penalty")return e.trialIData.push(t),!0},addPenalty:function(e,t){var i=t.errorLatency;if(i.use=="penalty"){var s=parseFloat(i.penalty),o=t.ErrorVar,u=t.AnalyzedVar,a=t.condVar,f=t.cond1VarValues,l=t.cond2VarValues,c=e.trialIData,h=e.avgCon1,p=e.avgCon2;n.each(c,function(e){var t=e.data,n=t[o],i=t[a],c=r.checkArray(i,f),d=r.checkArray(i,l);n=="1"&&(c?e[u]+=h+s:d&&(e[u]+=p+s))})}},avgAll:function(e){n.each(r.parcelArray,function(t){r.avgParcel(t,e)})},avgParcel:function(e,t){var i=e.trialIData,s=t.condVar,o=t.cond1VarValues,u=t.cond2VarValues,a=t.AnalyzedVar,f=0,l=0,c=0,h=0,p=0,d=0;n.each(i,function(e){var t=e[a],n=e.data;c+=t,d++;var i=n[s],v=r.checkArray(i,o),m=r.checkArray(i,u);v?(h++,f+=t):m&&(p++,l+=t)});if(h<=2||p<=2)r.scoreData.errorMessage="Not enough correct responses";h!==0&&(f/=h),p!==0&&(l/=p),e.avgCon1=f,e.avgCon2=l,e.diff=e.avgCon1-e.avgCon2,d!==0&&(e.avgBoth=c/d),r.addPenalty(e,t)},checkArray:function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r==e)return!0}return!1},varianceAll:function(e){n.each(r.parcelArray,function(t){r.varianceParcel(t,e)})},varianceParcel:function(e,t){var i=t.AnalyzedVar,s=e.trialIData,o=t.cond1VarValues,u=t.cond2VarValues,a=t.condVar,f=e.avgBoth,l=0,c=0,h=[],p=[],d=[],v=t.errorLatency,m=v.useForSTD;n.each(s,function(e){var n=e.data,s=e[i],f=t.ErrorVar,l=n[f],c=n[a],d=r.checkArray(c,o),v=r.checkArray(c,u);d?m?h.push(s):l=="0"&&h.push(s):v&&(m?p.push(s):l=="0"&&h.push(s))}),d=h.concat(p),n.each(d,function(e){var t=e;l=t-f,c+=l*l}),e.variance=c/(d.length-1)},scoreAll:function(e){var t=0;n.each(r.parcelArray,function(n){r.scoreParcel(n,e),t+=n.score});var i=t/r.parcelArray.length;r.scoreData.score=i.toFixed(2)},scoreParcel:function(e){var t=Math.sqrt(e.variance);t===0?(r.scoreData.errorMessage="Not enough correct responses",e.score=e.diff):e.score=e.diff/t},simulateOldCode:function(e){var t=[],i=[2,3,5,6],s=e.cond1VarValues,o=e.cond2VarValues,u=e.condVar,a=e.ErrorVar,f=e.AnalyzedVar,l=r.parcelArray[0],c=r.parcelArray[1],h=l.trialIData,p=c.trialIData;n.each(h,function(e){var n=e.data,l=n[u],c=r.checkArray(l,s),h=r.checkArray(l,o),p={};c?(p.block=i[0],p.lat=e[f],p.err=n[a]):h&&(p.block=i[2],p.lat=e[f],p.err=n[a]),t.push(p)}),n.each(p,function(e){var n=e.data,l=n[u],c=r.checkArray(l,s),h=r.checkArray(l,o),p={};c?(p.block=i[1],p.lat=e[f],p.err=n[a]):h&&(p.block=i[3],p.lat=e[f],p.err=n[a]),t.push(p)});var d=r.scoreTask(t,i);return d}}),r}),define("extensions/dscore/Scorer",["jquery","app/API","underscore","./computeD","./msgCat","./parcelMng"],function(e,t,n,r,i,s){var o={};return e.extend(o,{addSettings:function(e,t){e=="compute"?r.setComputeObject(t):e=="message"&&i.setMsgObject(t)},init:function(){!!window.console||(console={}),console.log||(console.log=function(){})},computeD:function(){o.init(),r.setDataArray(),s.Init(r),s.avgAll(r),s.varianceAll(r),s.scoreAll(r);var e=s.scoreData,t={};return e.errorMessage===undefined||e.errorMessage===null?(t.FBMsg=o.getFBMsg(e.score),t.DScore=e.score):(t.FBMsg=e.errorMessage,t.DScore=""),t},getInfo:function(){},postToServer:function(t,n,i,s){var o=r.postSettings||{},u=o.url;i||(i=o.score),s||(s=o.msg);var a={};return a[i]=t,a[s]=n,e.post(u,JSON.stringify(a))},getFBMsg:function(e){var t=i.getMsg(e);return t}}),o});