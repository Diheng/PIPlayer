define(["underscore"],function(e){var t=function(n,r){var i=[];return e.each(n,function(n){var s=e.isObject(n)?n.mixer:undefined,o,u;switch(s){case"random":o=e.shuffle(t(n.data,!0)),u=r?o:t(o),i=i.concat(u);break;case"choose":o=e.chain(n.data).shuffle().first(n.n?n.n:1).value(),u=r?o:t(o),i=i.concat(u);break;case"repeat":o=t(n.data,!0),u=r?o:t(o);for(var a=0;a<n.times;a++)i=i.concat(u);break;case"wrapper":r?i.push(n):i=i.concat(t(n.data));break;default:i.push(n)}}),i};return t});