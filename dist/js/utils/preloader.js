define(["jquery"],function(e){var t=[],n=[],r=0,i=e.Deferred(),s=function(s,o){o=o||"image";if(e.inArray(s,t)==-1){var u=e.Deferred();switch(o){case"template":try{require(["text!"+s],function(){u.resolve()})}catch(a){throw new Error("Template not found: "+s)}break;case"image":default:var f=new Image;e(f).on("load",function(){u.resolve()}),e(f).on("error",function(){throw new Error('Image not found: "'+s+'"')}),f.src=s}return n.push(u),t.push(s),u.done(function(){r++,i.notify(r,n.length)}),u}return!1};return{add:s,activate:function(){return e.when.apply(e,n).done(function(){i.resolve()}).fail(function(){i.reject()}),i.promise()},reset:function(){t=[],n=[],r=0,i=this.state=e.Deferred()},state:i}});